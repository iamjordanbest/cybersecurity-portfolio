# Performance Configuration for GRC Analytics Platform

# Redis Cache Configuration
cache:
  enabled: true
  host: localhost
  port: 6379
  db: 0
  
  # TTL settings (in seconds)
  ttl:
    short: 300      # 5 minutes
    medium: 3600    # 1 hour
    long: 86400     # 24 hours
    week: 604800    # 7 days
  
  # Cache strategies per data type
  strategies:
    risk_scores:
      enabled: true
      ttl: 86400  # 24 hours
      invalidate_on_update: true
    
    compliance_summary:
      enabled: true
      ttl: 3600  # 1 hour
      invalidate_on_update: true
    
    control_info:
      enabled: true
      ttl: 604800  # 7 days (rarely changes)
      invalidate_on_update: false
    
    trend_data:
      enabled: true
      ttl: 86400  # 24 hours
      invalidate_on_update: true
    
    roi_calculations:
      enabled: true
      ttl: 3600  # 1 hour
      invalidate_on_update: true

# Database Connection Pool Configuration
database:
  pool:
    enabled: true
    pool_size: 5          # Number of connections in pool
    max_overflow: 10      # Additional connections when pool exhausted
    timeout: 30           # Connection timeout in seconds
    recycle: 3600         # Recycle connections after 1 hour
    pre_ping: true        # Check connection health before use
  
  # SQLite-specific optimizations
  sqlite:
    journal_mode: WAL     # Write-Ahead Logging for better concurrency
    synchronous: NORMAL   # Balance between safety and speed
    cache_size: -64000    # 64MB cache (negative = KB)
    temp_store: MEMORY    # Use memory for temp tables
    mmap_size: 268435456  # 256MB memory-mapped I/O

# Performance Monitoring Configuration
monitoring:
  enabled: true
  
  # Slow query thresholds (in milliseconds)
  thresholds:
    query: 100           # Warn if query takes > 100ms
    function: 200        # Warn if function takes > 200ms
    api_endpoint: 500    # Warn if API call takes > 500ms
  
  # Metrics collection
  metrics:
    collect_stats: true
    retain_slow_queries: 100  # Keep last 100 slow queries
    reset_interval: 3600      # Reset metrics every hour
  
  # Logging
  logging:
    log_slow_queries: true
    log_cache_misses: false
    log_level: WARNING

# Query Optimization Settings
optimization:
  # Enable query result pagination
  pagination:
    enabled: true
    default_page_size: 100
    max_page_size: 1000
  
  # Batch processing
  batch:
    enabled: true
    default_batch_size: 50
    max_batch_size: 500
  
  # Query result limits
  limits:
    max_results: 10000
    default_limit: 100

# Background Job Configuration
background_jobs:
  # Automatic cache warming
  cache_warming:
    enabled: false
    schedule: "0 2 * * *"  # 2 AM daily (cron format)
    controls_to_warm: 100
  
  # Automatic risk score recalculation
  risk_score_update:
    enabled: false
    schedule: "0 3 * * *"  # 3 AM daily
    recalculate_all: false
  
  # Cache cleanup
  cache_cleanup:
    enabled: true
    schedule: "0 4 * * *"  # 4 AM daily
    remove_expired: true

# Performance Testing
testing:
  benchmark:
    num_controls: 50
    num_iterations: 100
    num_concurrent_threads: 5
    requests_per_thread: 10
  
  load_test:
    duration_seconds: 60
    concurrent_users: 10
    ramp_up_seconds: 10
